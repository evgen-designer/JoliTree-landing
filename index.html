<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JoliTree - Decorate Your Virtual Tree</title>
    <link rel="icon" href="images/ornaments/ornament_red.png">

    <!-- 1. LIBRARIES (React, ReactDOM, Babel, Tailwind) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. TAILWIND CONFIG -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1',
                            400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155',
                            800: '#1e293b', 900: '#0f172a'
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <!-- 3. CUSTOM CSS -->
    <style>
        /* Hide Scrollbars */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        body { 
            overscroll-behavior: none; 
            background-color: #F8FAFC;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Prevent text selection while dragging */
        .select-none { user-select: none; -webkit-user-select: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 4. REACT APPLICATION -->
    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- ASSETS CONFIGURATION ---
        // Make sure these match your folder structure exactly!
        const ORNAMENT_TYPES = {
            RED_BALL: {
                id: 'redBall',
                displayName: 'Red ball',
                image: 'images/ornaments/ornament_red.png'
            },
            BLUE_BALL: {
                id: 'blueBall',
                displayName: 'Blue ball',
                image: 'images/ornaments/ornament_blue.png'
            },
            STAR: {
                id: 'star',
                displayName: 'Star',
                image: 'images/ornaments/ornament_star.png'
            },
            CANDY_CANE: {
                id: 'candyCane',
                displayName: 'Candy cane',
                image: 'images/ornaments/ornament_candy_cane.png'
            },
            GIFT: {
                id: 'gift',
                displayName: 'Gift',
                image: 'images/ornaments/ornament_gift.png'
            }
        };

        const TREE_IMAGE = 'images/tree-bg.png';

        // --- ICONS (SVG Components) ---
        const HelpIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
        );

        // --- UI COMPONENTS (Replacements for Shadcn/Radix) ---
        
        // 1. Button
        const Button = ({ onClick, children, variant = 'default', className = '' }) => {
            const baseStyle = "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-slate-950 disabled:pointer-events-none disabled:opacity-50";
            const variants = {
                default: "bg-slate-900 text-slate-50 hover:bg-slate-900/90 shadow",
                outline: "border border-slate-200 bg-white hover:bg-slate-100 hover:text-slate-900",
                ghost: "hover:bg-slate-100 hover:text-slate-900"
            };
            return (
                <button onClick={onClick} className={`${baseStyle} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        // --- HOOKS ---
        function useLocalStorage(key, initialValue) {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    return initialValue;
                }
            });
            const setValue = (value) => {
                try {
                    const valueToStore = value instanceof Function ? value(storedValue) : value;
                    setStoredValue(valueToStore);
                    window.localStorage.setItem(key, JSON.stringify(valueToStore));
                } catch (error) { console.log(error); }
            };
            return [storedValue, setValue];
        }

        // --- FEATURE COMPONENTS ---

        // 1. OrnamentView (The draggable item)
        function OrnamentView({ ornament, treeBounds, onPositionUpdate }) {
            const [isDragging, setIsDragging] = useState(false);
            const [isHovered, setIsHovered] = useState(false);
            const dragStartRef = useRef({ x: 0, y: 0 });
            const type = Object.values(ORNAMENT_TYPES).find(t => t.id === ornament.kind);

            const left = treeBounds.left + (ornament.x * treeBounds.width);
            const top = treeBounds.top + (ornament.y * treeBounds.height);

            // Global Drag Listeners
            useEffect(() => {
                if (!isDragging) return;

                const handleMove = (clientX, clientY) => {
                    const dx = clientX - dragStartRef.current.x;
                    const dy = clientY - dragStartRef.current.y;
                    dragStartRef.current = { x: clientX, y: clientY };
                    onPositionUpdate(ornament.id, dx, dy);
                };

                const onMouseMove = (e) => handleMove(e.clientX, e.clientY);
                const onTouchMove = (e) => {
                    e.preventDefault(); // Stop scroll
                    handleMove(e.touches[0].clientX, e.touches[0].clientY);
                };
                const onEnd = () => setIsDragging(false);

                window.addEventListener('mousemove', onMouseMove);
                window.addEventListener('mouseup', onEnd);
                window.addEventListener('touchmove', onTouchMove, { passive: false });
                window.addEventListener('touchend', onEnd);

                return () => {
                    window.removeEventListener('mousemove', onMouseMove);
                    window.removeEventListener('mouseup', onEnd);
                    window.removeEventListener('touchmove', onTouchMove);
                    window.removeEventListener('touchend', onEnd);
                };
            }, [isDragging, ornament.id, onPositionUpdate]);

            const startDrag = (clientX, clientY) => {
                setIsDragging(true);
                dragStartRef.current = { x: clientX, y: clientY };
            };

            return (
                <div
                    className="absolute z-20 cursor-grab active:cursor-grabbing select-none"
                    style={{
                        left: left,
                        top: top,
                        transform: 'translate(-50%, -50%)',
                        touchAction: 'none'
                    }}
                    onMouseDown={(e) => { e.preventDefault(); startDrag(e.clientX, e.clientY); }}
                    onTouchStart={(e) => { startDrag(e.touches[0].clientX, e.touches[0].clientY); }}
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                >
                    <div className="relative group">
                        <img 
                            src={type.image} 
                            alt={type.displayName} 
                            className="w-16 h-16 object-contain drop-shadow-lg pointer-events-none select-none transition-transform duration-200 active:scale-110" 
                        />
                        {/* Hover Effect Ring */}
                        {isHovered && !isDragging && (
                            <div className="absolute inset-0 border-2 border-dashed border-blue-400/50 rounded-full animate-pulse pointer-events-none"></div>
                        )}
                    </div>
                </div>
            );
        }

        // 2. TreeCanvas (The main area)
        function TreeCanvas({ ornaments, onPositionUpdate }) {
            const treeRef = useRef(null);
            const canvasRef = useRef(null);
            const [treeBounds, setTreeBounds] = useState({ width: 0, height: 0, left: 0, top: 0 });

            const updateBounds = () => {
                if (treeRef.current && canvasRef.current) {
                    const treeRect = treeRef.current.getBoundingClientRect();
                    const canvasRect = canvasRef.current.getBoundingClientRect();
                    setTreeBounds({
                        width: treeRect.width,
                        height: treeRect.height,
                        left: treeRect.left - canvasRect.left,
                        top: treeRect.top - canvasRect.top
                    });
                }
            };

            useEffect(() => {
                updateBounds();
                window.addEventListener('resize', updateBounds);
                const img = treeRef.current;
                if (img) img.addEventListener('load', updateBounds);
                return () => window.removeEventListener('resize', updateBounds);
            }, []);

            return (
                <div ref={canvasRef} className="relative w-full h-full flex items-center justify-center overflow-hidden bg-gradient-to-b from-slate-50 via-purple-50/30 to-white">
                    
                    {/* Ambient Glow Background */}
                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-0">
                        <div className="w-[600px] h-[600px] bg-purple-200/30 rounded-full blur-[120px] opacity-60 animate-pulse-slow"></div>
                        <div className="absolute w-[500px] h-[500px] bg-blue-200/20 rounded-full blur-[100px] opacity-50 mix-blend-multiply"></div>
                    </div>

                    {/* Tree Image */}
                    <div className="relative z-10 h-[85%] max-w-[90%] flex items-end justify-center pb-20 md:pb-0">
                        <img
                            ref={treeRef}
                            src={TREE_IMAGE}
                            alt="Christmas Tree"
                            className="h-full w-auto object-contain drop-shadow-2xl select-none pointer-events-none"
                        />
                    </div>

                    {/* Render Ornaments */}
                    {treeBounds.width > 0 && ornaments.map(orn => (
                        <OrnamentView 
                            key={orn.id} 
                            ornament={orn} 
                            treeBounds={treeBounds} 
                            onPositionUpdate={onPositionUpdate} 
                        />
                    ))}
                </div>
            );
        }

        // 3. OrnamentPalette (Sidebar)
        function OrnamentPalette({ onAddOrnament, onClearAll }) {
            const types = Object.values(ORNAMENT_TYPES);

            return (
                <div className="flex flex-col h-full bg-white border-r border-slate-200 relative z-20">
                    {/* Desktop Header */}
                    <div className="p-6 border-b border-slate-100 hidden md:block">
                        <h2 className="text-slate-900 text-2xl font-bold tracking-tight">JoliTree</h2>
                    </div>

                    {/* Desktop List (ScrollArea equivalent) */}
                    <div className="hidden md:flex flex-1 overflow-y-auto p-4 flex-col gap-3">
                        {types.map((type) => (
                            <button
                                key={type.id}
                                onClick={() => onAddOrnament(type.id)}
                                className="w-full group flex items-center gap-4 p-3 bg-white border border-slate-200 rounded-xl hover:border-slate-300 hover:shadow-sm transition-all duration-200 text-left focus:outline-none focus:ring-2 focus:ring-slate-200"
                            >
                                <div className="w-10 h-10 flex items-center justify-center shrink-0">
                                    <img src={type.image} className="w-full h-full object-contain group-hover:scale-110 transition-transform duration-200" />
                                </div>
                                <span className="font-medium text-slate-700 group-hover:text-slate-900">{type.displayName}</span>
                            </button>
                        ))}
                    </div>

                    {/* Mobile Horizontal List */}
                    <div className="md:hidden flex-1 flex items-center overflow-x-auto p-3 gap-3 no-scrollbar">
                        {types.map((type) => (
                            <button
                                key={type.id}
                                onClick={() => onAddOrnament(type.id)}
                                className="flex-shrink-0 flex flex-col items-center justify-center w-20 h-20 bg-white border border-slate-200 rounded-xl active:scale-95 transition-transform shadow-sm"
                            >
                                <img src={type.image} className="w-9 h-9 object-contain mb-1" />
                                <span className="text-[10px] font-medium text-slate-600 leading-tight text-center">{type.displayName}</span>
                            </button>
                        ))}
                    </div>

                    {/* Footer / Clear Button */}
                    <div className="p-4 border-t border-slate-100 bg-white">
                        <Button
                            onClick={onClearAll}
                            variant="outline"
                            className="w-full rounded-full border-slate-300 text-slate-600 hover:text-slate-900 hover:bg-slate-50 h-11 font-medium"
                        >
                            Clear all
                        </Button>
                    </div>
                </div>
            );
        }

        // --- MAIN APPLICATION ---
        function App() {
            const [ornaments, setOrnaments] = useLocalStorage('jolitree-ornaments-v2', []);

            const addOrnament = (kindId) => {
                const newOrnament = {
                    id: crypto.randomUUID(),
                    kind: kindId,
                    x: 0.5 + (Math.random() * 0.1 - 0.05),
                    y: 0.4 + (Math.random() * 0.1 - 0.05),
                };
                setOrnaments([...ornaments, newOrnament]);
            };

            const updateOrnamentPosition = (id, dx, dy) => {
                setOrnaments(prev => prev.map(orn => {
                    if (orn.id !== id) return orn;
                    
                    const canvas = document.querySelector('[data-canvas]');
                    const treeImg = canvas?.querySelector('img[alt="Christmas Tree"]');
                    if (!treeImg) return orn;
                    
                    const rect = treeImg.getBoundingClientRect();
                    return {
                        ...orn,
                        x: Math.max(0, Math.min(1, orn.x + (dx / rect.width))),
                        y: Math.max(0, Math.min(1, orn.y + (dy / rect.height)))
                    };
                }));
            };

            const resetOrnaments = () => {
                if(confirm("Remove all ornaments?")) setOrnaments([]);
            };

            return (
                <div className="h-screen w-full flex flex-col md:flex-row overflow-hidden bg-[#F8FAFC]">
                    
                    {/* Mobile Header Download Button */}
                    <div className="md:hidden flex justify-center py-4 bg-gradient-to-b from-slate-100 via-slate-50 to-white z-10">
                        <a href="#" className="px-6 py-2.5 bg-slate-900 text-white rounded-full text-sm font-medium shadow-lg">
                            Download for MacOS
                        </a>
                    </div>

                    {/* Sidebar (Left on Desktop) */}
                    <div className="hidden md:block w-[280px] shrink-0 h-full shadow-xl shadow-slate-200/50 z-20">
                        <OrnamentPalette onAddOrnament={addOrnament} onClearAll={resetOrnaments} />
                    </div>

                    {/* Main Content */}
                    <main className="flex-1 relative h-full flex flex-col" data-canvas>
                        
                        {/* Top Navigation */}
                        <div className="absolute top-0 right-0 left-0 p-6 flex justify-between md:justify-end items-center z-30 pointer-events-none">
                            {/* Mobile Logo */}
                            <span className="md:hidden text-xl font-bold text-slate-900 pointer-events-auto">JoliTree</span>
                            
                            <div className="flex items-center gap-6 pointer-events-auto">
                                <nav className="hidden md:flex gap-6 text-sm font-medium text-slate-500">
                                    <a href="#" className="hover:text-slate-900 transition-colors">Contact</a>
                                    <a href="#" className="hover:text-slate-900 transition-colors">Privacy</a>
                                    <a href="#" className="hover:text-slate-900 transition-colors">Terms</a>
                                </nav>
                                <div className="hidden md:block text-xs text-slate-400">© 2025 JoliTree</div>
                                {/* Mobile Help */}
                                <button className="md:hidden w-8 h-8 flex items-center justify-center bg-slate-900 text-white rounded-full shadow-md">
                                    <HelpIcon />
                                </button>
                            </div>
                        </div>

                        {/* Canvas */}
                        <div className="flex-1 relative w-full h-full overflow-hidden">
                            <TreeCanvas ornaments={ornaments} onPositionUpdate={updateOrnamentPosition} />

                            {/* Desktop Floating Button */}
                            <div className="hidden md:flex absolute bottom-8 left-1/2 -translate-x-1/2 z-40 pointer-events-auto">
                                <a href="#" className="px-8 py-4 bg-[#0F172A] hover:bg-[#1E293B] text-white text-lg font-medium rounded-full shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300">
                                    Download for MacOS
                                </a>
                            </div>
                        </div>

                        {/* Mobile Bottom Palette */}
                        <div className="md:hidden h-auto border-t border-slate-200 bg-white z-20 shrink-0 pb-safe">
                            <OrnamentPalette onAddOrnament={addOrnament} onClearAll={resetOrnaments} />
                        </div>

                        {/* Mobile Footer Links */}
                         <div className="md:hidden flex flex-col items-center py-4 text-sm text-gray-600 bg-white border-t border-slate-200 z-20">
                            <div className="flex gap-4 mb-2">
                                <a href="#" className="hover:text-gray-900">Contact</a>
                                <a href="#" className="hover:text-gray-900">Privacy</a>
                                <a href="#" className="hover:text-gray-900">Terms</a>
                            </div>
                            <div className="text-gray-400 text-[10px]">© 2025 JoliTree. All rights reserved.</div>
                        </div>

                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
